package components

templ UploadEpubModal() {
	<div
		id="upload-epub-modal"
		hx-swap-oob="true"
		class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
		x-data="{
			dragover: false,
			file: null,
			handleDrop(event) {
				event.preventDefault();
				this.dragover = false;
				if (!event.dataTransfer.files.length) return;

				const droppedFile = event.dataTransfer.files[0];
				if (droppedFile && droppedFile.name.endsWith('.epub')) {
					this.file = droppedFile;

					// Update the UI to display the dropped file
					const fileInput = document.getElementById('epub-file');
					fileInput.files = event.dataTransfer.files;

					// Display the file name in the UI
					const fileNameElement = document.getElementById('selected-file-name');
					fileNameElement.textContent = droppedFile.name;
					document.getElementById('file-name').classList.remove('hidden');
				}
			},
			handleFileSelect(event) {
				if (!event.target.files.length) return;

				const selectedFile = event.target.files[0];
				if (selectedFile && selectedFile.name.endsWith('.epub')) {
					this.file = selectedFile;

					// Display the file name in the UI
					const fileNameElement = document.getElementById('selected-file-name');
					fileNameElement.textContent = selectedFile.name;
					document.getElementById('file-name').classList.remove('hidden');
				}
			}
		}"
		:class="{ '*:cursor-alias': dragover }"
		@dragover.prevent="dragover = true"
		@dragleave.prevent="dragover = false"
		@drop.prevent="handleDrop"
	>
		<div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6">
			<div class="flex justify-between items-center mb-4">
				<h3 class="text-lg font-semibold text-gray-900 dark:text-white">Upload EPUB Book</h3>
				<button
					type="button"
					class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300"
					hx-get="/books/upload/cancel"
					hx-swap="none"
				>
					<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
					</svg>
				</button>
			</div>
			<form
				id="form-upload"
				class="space-y-4"
				hx-encoding="multipart/form-data"
				hx-post="/books/upload"
				hx-swap="none"
			>
				<div
					class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center"
					:class="{ 'bg-blue-50 dark:bg-gray-700': dragover }"
				>
					<label for="epub-file" class="cursor-pointer">
						<div x-show="!file">
							<svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
							</svg>
						</div>
						<div x-show="file">
							<svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
							</svg>
						</div>
						<p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Click to select or drag and drop</p>
						<p class="text-xs text-gray-500 dark:text-gray-500">EPUB files only</p>
						<input
							id="epub-file"
							name="epub-file"
							type="file"
							accept=".epub"
							class="hidden"
							required
							@change="handleFileSelect"
						/>
					</label>
				</div>
				<div id="file-name" class="text-sm text-gray-600 dark:text-gray-400 hidden">
					<span>Selected file: </span>
					<span id="selected-file-name"></span>
				</div>
				<div class="flex justify-end space-x-3">
					<button
						type="button"
						class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 transition-colors"
						hx-get="/books/upload/cancel"
					>
						Cancel
					</button>
					<button
						type="submit"
						class="px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-400 transition-colors"
					>
						Upload
					</button>
				</div>
			</form>
		</div>
	</div>
}

templ UploadEpubModalOff() {
	<div id="upload-epub-modal" hx-swap-oob="true"></div>
}
